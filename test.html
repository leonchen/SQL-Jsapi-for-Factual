<html>
  <head>
    <script src="klass.js"></script>
    <script src="jquery.js"></script>
    <script src="ajax.js"></script>
    <script src="postMessage.js"></script>
    <script src="md5.js"></script>
    <script src="base.js"></script>
    <script src="sql_parser.js"></script>
    <script src="payload_parser.js"></script>
    <style>
      .sql{
        width: 800px;
        height: 200px;
      }
      .apiKey{
        width: 600px;
      }
      table{
        border: 1px solid #333;
        border-collapse: collapse;
      }
      th{
        background-color: #ccc;
        border: 1px solid #333;
      }
      td{
        border: 1px solid #333;
      }

    </style>
  </head>
  <body>
    <p>Factual APIKey: <input class="apiKey" /></p>
    <p>Run Sql:</p>
    <textarea class="sql">
    </textarea>
    <input class="run" type="button" value="run"/>
    <br />
    <table class="results"></table>
    <script>
      var sqlJsapi = Jsapi.Sql.$new();

      $('textarea.sql').val('');
      $('input.run').click(function(){
        var apiKey = $('.apiKey').val();
        if (apiKey.length != 64) {
          alert('apiKey should have 64 chars');
          return;
        }
        sqlJsapi.apiKey = apiKey;
        sqlJsapi.execute($('textarea.sql').val(), function (rows) {
          populateResults(rows);
        });
      });

      var $resultTable = $('table.results');
      function populateResults (rows) {
        var html = [];

        html.push('<tr>');
        $.each(rows.fields, function (i,f) {
          html.push('<th>'+f+'</th>');
        });
        html.push('</tr>');

        for (var i=0,len=rows.length;i<len;i++){
          var row = rows[i];

          html.push('<tr>');
            for (var f in row) {
            html.push('<td>'+row[f]+'</td>');
          }
          html.push('</tr>');
        }
        $resultTable.html(html.join(''));
      }

    </script>
  </body>
</html>
